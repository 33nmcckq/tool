local Rep = game:GetService("ReplicatedStorage")
local CraftRemote = Rep.GameEvents.CraftingGlobalObjectService
local bench = workspace.Interaction.UpdateItems.Model.GiantCraftingWorkBench
local player = game.Players.LocalPlayer

-- ğŸ” Láº¥y táº¥t cáº£ UUID cá»§a itemName tá»« Backpack + Character
local function getUUID(itemName, used)
    for _, item in ipairs(player.Backpack:GetChildren()) do
        if string.find(item.Name, itemName) and item:GetAttribute("c") and not used[item:GetAttribute("c")] then
            return item:GetAttribute("c")
        end
    end
    for _, item in ipairs(player.Character:GetChildren()) do
        if string.find(item.Name, itemName) and item:GetAttribute("c") and not used[item:GetAttribute("c")] then
            return item:GetAttribute("c")
        end
    end
    return nil
end

-- ğŸ“Œ Chá»n recipe
local function setRecipe(recipeName)
    CraftRemote:FireServer("SetRecipe", bench, "GiantBeanstalkEventWorkbench", recipeName)
    print("ğŸ“œ ÄÃ£ chá»n recipe:", recipeName)
end

-- ğŸ“¤ Input item vÃ o slot
local function inputItem(slot, itemName, itemType, used)
    local uuid = getUUID(itemName, used)
    if not uuid then
        warn("âŒ Thiáº¿u item:", itemName)
        return false
    end

    local args = {
        [1] = "InputItem",
        [2] = bench,
        [3] = "GiantBeanstalkEventWorkbench",
        [4] = slot,
        [5] = {
            ["ItemType"] = itemType,
            ["ItemData"] = {["UUID"] = uuid}
        }
    }
    CraftRemote:FireServer(unpack(args))
    used[uuid] = true
    print("âœ… "..itemName.." -> slot "..slot)

    return true
end

-- ğŸ›  Craft
local function doCraft()
    CraftRemote:FireServer("Craft", bench, "GiantBeanstalkEventWorkbench")
    print("ğŸ‰ ÄÃ£ craft xong")
end

-- ğŸ“¦ Claim + Spin
local function claimAndSpin()
    local args = {
        [1] = "Claim",
        [2] = bench,
        [3] = "GiantBeanstalkEventWorkbench",
        [4] = 1
    }
    CraftRemote:FireServer(unpack(args))
    print("ğŸ“¦ ÄÃ£ Claim sáº£n pháº©m thÃ nh cÃ´ng")

    -- Spin
    game:GetService("ReplicatedStorage").GameEvents.SeedPack.SpinFinished:FireServer()
    local extraArgs = {
        [1] = false,
        [2] = CFrame.new(-125.4154, 183.2402, -43.8324) * CFrame.Angles(-2.31748, 1.18203, 2.35622)
    }
    game:GetService("Players").LocalPlayer.PlayerScripts.InputGateway.Activation:FireServer(unpack(extraArgs))
    print("âœ… ÄÃ£ gá»­i SpinFinished & Activation")
end

-- ğŸ” Luá»“ng craft Skyroot Chest
local function craftSkyrootChest()
    setRecipe("Skyroot Chest")
    local used = {}

    -- Beanstalk 1
    if not inputItem(1, "Beanstalk", "Holdable", used) then return end
    task.wait(2)

    -- Beanstalk 2
    if not inputItem(2, "Beanstalk", "Holdable", used) then return end
    task.wait(2)

    -- Sprout Seed Pack
    if not inputItem(3, "Sprout Seed Pack", "Seed Pack", used) then return end
    task.wait(0.5)

    -- Sprout Egg
    if not inputItem(4, "Sprout Egg", "PetEgg", used) then return end
    task.wait(0.5)

    -- Craft + Claim + Spin
    doCraft()
    task.wait(1)
    claimAndSpin()
end

-- ğŸ”‚ VÃ²ng láº·p auto
task.spawn(function()
    local count = 0
    while true do
        count += 1
        print("ğŸ”„ Báº¯t Ä‘áº§u láº§n craft thá»© "..count)

        craftSkyrootChest()

        print("â³ Chá» 1800 giÃ¢y trÆ°á»›c láº§n craft tiáº¿p theo...")
        task.wait(1800)
    end
end)
